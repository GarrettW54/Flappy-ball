<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Flappy Football ‚Äî Stadium Edition</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root{
  --bg-sky:#70c8ff;
  --field:#2e9f4a;
  --ui:rgba(0,0,0,0.35);
}

html,body{
  margin:0;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#87cefa;
  font-family:Segoe UI,Roboto,Arial,sans-serif;
}
#game-wrap{
  position:relative;
  width:420px;
  max-width:100%;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 8px 30px rgba(0,0,0,0.4);
}
canvas{width:100%;height:auto;display:block;}
#score{
  position:absolute;
  top:10px;left:50%;
  transform:translateX(-50%);
  color:#fff;font-size:42px;
  font-weight:700;text-shadow:2px 2px 0 #000;
  z-index:5;
}
#overlay{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  z-index:10;
}
.card{
  background:var(--ui);
  backdrop-filter:blur(3px);
  color:#fff;
  padding:16px;
  border-radius:10px;
  text-align:center;
}
.btn{background:#fff;color:#000;padding:8px 14px;border:0;border-radius:8px;cursor:pointer;font-weight:600}
.team-btn{margin:6px 0;padding:6px;border-radius:6px;cursor:pointer;border:0;font-weight:600;width:100%}
</style>
</head>
<body>

<div id="game-wrap">
  <canvas id="game" width="420" height="640" tabindex="0"></canvas>
  <div id="score">0</div>
  <div id="overlay"></div>
</div>

<script>
/* CONFIG */
const CANVAS_W=420,CANVAS_H=640,GRAVITY=.45,FLAP=-8.5,R=22;
const GAP=160,POST_W=56,FIELD=110;

/* TEAM COLORS (ball skin) */
const TEAMS = {
  "Razorbacks": "#9b1c2c",
  "Cowboys": "#002244",
  "Packers": "#203731",
  "Chiefs": "#e31836"
};
let selectedColor = Object.values(TEAMS)[0];

/* SOUNDS */
const audio = {
  flap: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-air-fast-woosh-1106.mp3"),
  score: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-small-crowd-cheer-and-applause-518.mp3"),
  death: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-metal-hit-woosh-1484.mp3"),
  announceScore: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-cheerful-male-voice-says-touchdown-499.mp3"),
  announceOver: new Audio("https://assets.mixkit.co/sfx/preview/mixkit-sports-game-over-voice-2054.mp3")
};

/* LOCAL STORAGE LEADERBOARD */
let leaderboard = JSON.parse(localStorage.getItem("ff_board")||"[]");
function saveScore(val){
  leaderboard.push({name:"Player",value:val});
  leaderboard.sort((a,b)=>b.value-a.value);
  leaderboard = leaderboard.slice(0,5);
  localStorage.setItem("ff_board",JSON.stringify(leaderboard));
}

/* ACHIEVEMENTS */
let achievements = JSON.parse(localStorage.getItem("ff_ach")||"{}");
const TARGETS=[5,10,20,50];
function checkAchievement(score){
  if(TARGETS.includes(score) && !achievements[score]){
    achievements[score]=true;
    localStorage.setItem("ff_ach",JSON.stringify(achievements));
    alert("üèÜ Achievement: " + score + " Points!");
  }
}

/* GAME VARS */
const c=document.getElementById("game"),ctx=c.getContext("2d");
let posts=[],state="team",score=0,fb,last,timer;
function reset(){
  fb={x:CANVAS_W*.22,y:CANVAS_H/2,vy:0,rot:0};
  posts=[],score=0,last=performance.now();
}

/* UI SCREENS */
const overlay=document.getElementById("overlay"),scoreEl=document.getElementById("score");
function showTeamSelect(){
  overlay.innerHTML = `
   <div class="card">
     <div style="font-size:22px;font-weight:700">Select Team</div>
     ${Object.entries(TEAMS).map(([t,c])=>`<button class="team-btn" style="background:${c}" onclick="pickTeam('${c}')">${t}</button>`).join("")}
   </div>`;
}
function pickTeam(color){
  selectedColor=color;
  showMenu();
}
function showMenu(){
  overlay.innerHTML=`
      <div style="font-size:24px;font-weight:700">FLAPPY FOOTBALL</div>
      <button class="btn" onclick="start()">Play</button>
      <div style="margin-top:10px;font-size:14px">Tap/Space/ArrowUp to flap</div>
    </div>`;
  state="menu";
}
function gameOver(){
  saveScore(score);
  audio.announceOver.play();
  overlay.innerHTML=`
    <div class="card">
      <div style="font-size:22px;font-weight:700">Game Over</div>
      <div>Score: <b>${score}</b></div>
      <div style="margin-top:8px">Leaderboard:<br>${leaderboard.map(x=>x.value).join(" ¬∑ ")}</div>
      <button class="btn" onclick="start()">Restart</button>
    </div>`;
  state="over";
}

/* START GAME */
function start(){
  reset();
  overlay.innerHTML="";
  scoreEl.textContent="0";
  state="run";
  loop();
}

/* INPUT (rewritten for robust tap detection) */
function flap(){
  if(state!=="run")return;
  fb.vy=FLAP; fb.rot=-.8;
  audio.flap.play();
}
// Keyboard support: Space, ArrowUp
window.addEventListener("keydown",e=>{
  if(state!=="run")return;
  if(e.code==="Space"||e.code==="ArrowUp"){e.preventDefault();flap();}
});
// Mouse click on canvas
c.addEventListener("mousedown",()=>{
  if(state==="run")flap();
});
// Touch support
c.addEventListener("touchstart",e=>{
  e.preventDefault();
  if(state==="run")flap();
  c.focus && c.focus();
},{passive:false});

/* SPAWN POSTS */
function spawn(){
  const top = 40 + Math.random()* (CANVAS_H-FIELD-GAP-80);
  posts.push({x:CANVAS_W+80,top,passed:0});
}

/* LOOP */
function loop(t){
  if(state!=="run")return;
  const dt=Math.min(40,(t-last)||16); last=t;

  fb.vy += GRAVITY*(dt/16.6);
  fb.y += fb.vy*(dt/16.6);
  fb.rot += .03;

  if(!timer){spawn(); timer=performance.now();}
  if(performance.now()-timer>1500+Math.random()*500)spawn(),timer=performance.now();

  posts.forEach(p=>p.x-=2.4);
  posts = posts.filter(p=>p.x>-100);

  posts.forEach(p=>{
    if(!p.passed && p.x+POST_W<fb.x){p.passed=1;score++;scoreEl.textContent=score;checkAchievement(score);audio.score.play();audio.announceScore.play();}
  });

  if(hit())return audio.death.play(),gameOver();
  draw();
  requestAnimationFrame(loop);
}

/* COLLISION */
function hit(){
  if(fb.y+R>CANVAS_H-FIELD||fb.y-R<0)return 1;
  for(const p of posts){
    if(fb.x+R>p.x && fb.x-R<p.x+POST_W){
      if(fb.y-R<p.top || fb.y+R>p.top+GAP)return 1;
    }
  }
}

/* DRAW (rewritten crowd section) */
function draw(){
  ctx.clearRect(0,0,CANVAS_W,CANVAS_H);

  /* sky */
  let g=ctx.createLinearGradient(0,0,0,CANVAS_H);
  g.addColorStop(0,"#70c8ff"); g.addColorStop(.6,"#bfeeff");
  ctx.fillStyle=g; ctx.fillRect(0,0,CANVAS_W,CANVAS_H);

  /* stadium stands background */
  const st=150,sb=CANVAS_H-FIELD-30;
  let crowdBg=ctx.createLinearGradient(0,st,0,sb);
  crowdBg.addColorStop(0,"#111");crowdBg.addColorStop(1,"#333");
  ctx.fillStyle=crowdBg;
  ctx.fillRect(0,st,CANVAS_W,sb-st);

  // Animated crowd: colored circles (heads), some team colors, some white
  let time = Date.now()/500;
  for(let i=0;i<100;i++){
    let x=(i%20)*21 + 10 + Math.sin(time+i)*2; // more regular spacing
    let y=st+20+((i/20|0)*20) + Math.cos(time*1.5+i)*2;
    let r=5+Math.random()*2;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fillStyle = i%5===0 ? selectedColor : "#fff";
    ctx.globalAlpha = 0.8 + 0.2*Math.sin(time+i); // subtle wave effect
    ctx.fill();
    ctx.globalAlpha = 1;
  }

  // Random extra sparkles over crowd for energy
  ctx.fillStyle="rgba(255,255,255,.12)";
  for(let i=0;i<40;i++){
    ctx.fillRect(Math.random()*CANVAS_W, st+Math.random()*(sb-st),2,2);
  }

  /* scoreboard */
  ctx.fillStyle="#000";ctx.fillRect(CANVAS_W/2-90,st-50,180,40);
  ctx.fillStyle="#fff";ctx.font="16px sans-serif";ctx.textAlign="center";
  ctx.fillText("üèà Stadium Bowl üèà",CANVAS_W/2,st-25);

  /* posts */
  ctx.fillStyle="#ffd400";
  posts.forEach(p=>{
    ctx.fillRect(p.x,0,POST_W,p.top);
    ctx.fillRect(p.x,p.top+GAP,POST_W,CANVAS_H-p.top-GAP-FIELD);
  });

  /* field */
  ctx.fillStyle="#2e9f4a";ctx.fillRect(0,CANVAS_H-FIELD,CANVAS_W,FIELD);

  /* ball */
  ctx.save();ctx.translate(fb.x,fb.y);ctx.rotate(fb.rot);
  ctx.beginPath();ctx.ellipse(0,0,R,R*.62,0,0,Math.PI*2);
  ctx.fillStyle=selectedColor;ctx.fill();ctx.restore();
}

/* INIT */
showTeamSelect();
</script>
</body>
</html>

